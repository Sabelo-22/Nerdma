<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Market Trend Predictor and Recommendation System</title>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	</head>
	<body>
		<h1>Sentiment Analysis of Tweets</h1>
		<canvas id="sentimentChart" width="400" height="200"></canvas>

		<h1>Market Data Visualization</h1>
		<canvas id="lineChart" width="400" height="200"></canvas>
		<canvas id="barChart" width="400" height="200"></canvas>

		<script>
			// Fetch and display sentiment data
			fetch("/api/tweets")
				.then((response) => response.json())
				.then((data) => {
					const sentiments = data.map((item) => item.sentiment);
					const sentimentCounts = {
						positive: sentiments.filter((s) => s === "positive").length,
						negative: sentiments.filter((s) => s === "negative").length,
						neutral: sentiments.filter((s) => s === "neutral").length,
					};

					const ctx = document
						.getElementById("sentimentChart")
						.getContext("2d");
					new Chart(ctx, {
						type: "pie",
						data: {
							labels: ["Positive", "Negative", "Neutral"],
							datasets: [
								{
									data: Object.values(sentimentCounts),
									backgroundColor: ["#36A2EB", "#FF6384", "#FFCE56"],
								},
							],
						},
					});
				})
				.catch((error) => console.error("Error fetching tweets:", error));

			// Fetch and display market data
			fetch("/api/market-data")
				.then((response) => response.json())
				.then((data) => {
					if (data.length === 0) {
						console.error("No market data available");
						return;
					}

					const labels = data.map((row) =>
						new Date(row.timestamp).toLocaleDateString()
					);
					const values = data.map((row) => parseFloat(row.value));
					const locations = data.map((row) => row.location);
					const uniqueLocations = [...new Set(locations)];
					const locationCounts = uniqueLocations.map(
						(location) => locations.filter((loc) => loc === location).length
					);

					// Line chart
					const lineCtx = document.getElementById("lineChart").getContext("2d");
					new Chart(lineCtx, {
						type: "line",
						data: {
							labels: labels,
							datasets: [
								{
									label: "Market Value",
									data: values,
									borderColor: "#FF5733",
									backgroundColor: "rgba(255, 87, 51, 0.2)",
									borderWidth: 1,
									fill: true,
								},
							],
						},
						options: {
							responsive: true,
							scales: {
								x: {
									title: {
										display: true,
										text: "Date",
									},
								},
								y: {
									title: {
										display: true,
										text: "Value",
									},
								},
							},
						},
					});

					// Bar chart for locations
					const barCtx = document.getElementById("barChart").getContext("2d");
					new Chart(barCtx, {
						type: "bar",
						data: {
							labels: uniqueLocations,
							datasets: [
								{
									label: "Number of Entries",
									data: locationCounts,
									backgroundColor: "#4BC0C0",
									borderColor: "#4BC0C0",
									borderWidth: 1,
								},
							],
						},
						options: {
							responsive: true,
							scales: {
								x: {
									title: {
										display: true,
										text: "Location",
									},
								},
								y: {
									title: {
										display: true,
										text: "Number of Entries",
									},
								},
							},
						},
					});
				})
				.catch((error) => console.error("Error fetching market data:", error));
		</script>
	</body>
</html>
