<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Market Trend Predictor Dashboard</title>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<link rel="stylesheet" href="./public/css/dashboard.css" />
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 0;
				display: flex;
			}
			.container {
				display: flex;
				width: 100%;
			}
			nav.sidebar {
				width: 250px;
				background-color: #2c3e50;
				color: #ecf0f1;
				padding: 20px;
				height: 100vh;
				position: fixed;
			}
			.sidebar .profile {
				display: flex;
				align-items: center;
				margin-bottom: 20px;
			}
			.sidebar .profile .profile-pic {
				width: 50px;
				height: 50px;
				border-radius: 50%;
				margin-right: 10px;
			}
			.sidebar .profile .username {
				font-size: 18px;
				font-weight: bold;
			}
			.sidebar .nav-items {
				list-style: none;
				padding: 0;
			}
			.sidebar .nav-items li {
				margin-bottom: 10px;
			}
			.sidebar .nav-items li a {
				color: #ecf0f1;
				text-decoration: none;
				font-size: 16px;
				display: block;
				padding: 10px;
				border-radius: 5px;
			}
			.sidebar .nav-items li a:hover {
				background-color: #34495e;
			}
			main.main-content {
				margin-left: 250px;
				padding: 20px;
				width: calc(100% - 250px);
			}
			.chart-container {
				width: 80%;
				margin: 0 auto;
				margin-bottom: 40px;
			}
			canvas {
				display: block;
				max-width: 100%;
				height: auto;
			}
			.chart-wrapper {
				display: flex;
				flex-wrap: wrap;
				justify-content: space-around;
			}
			.chart-container-small {
				width: 45%;
				margin: 10px;
			}
			.chart {
				flex: 1 1 45%;
				margin: 10px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<nav class="sidebar">
				<div class="profile">
					<img
						src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Standard_Bank_logo.png"
						alt="Profile Picture"
						class="profile-pic"
					/>
					<p class="username">John Doe</p>
				</div>
				<ul class="nav-items">
					<li><a href="#dashboard">Dashboard</a></li>
					<li><a href="#analytics">Analytics</a></li>
					<li><a href="#settings">Settings</a></li>
					<li><a href="#logout">Logout</a></li>
				</ul>
			</nav>
			<main class="main-content">
				<h1>Sentiment Analysis of Tweets</h1>
				<div class="chart-wrapper">
					<div class="chart-container-small">
						<canvas id="sentimentChart"></canvas>
					</div>
					<div class="chart-container-small">
						<canvas id="additionalPieChart"></canvas>
					</div>
				</div>

				<h1>Market Data Visualization</h1>
				<div class="chart-wrapper">
					<div class="chart">
						<h2>Market Value Over Time</h2>
						<canvas id="lineChart"></canvas>
					</div>
					<div class="chart">
						<h2>Number of Entries by Location</h2>
						<canvas id="barChart"></canvas>
					</div>
				</div>
			</main>
		</div>
		<script src="scripts.js"></script>
		<script>
			fetch("/api/tweets")
				.then((response) => response.json())
				.then((tweets) => {
					const sentiments = { positive: 0, negative: 0, neutral: 0 };
					const likes = { positive: 0, negative: 0, neutral: 0 };
					const retweets = { positive: 0, negative: 0, neutral: 0 };
					const replies = { positive: 0, negative: 0, neutral: 0 };

					tweets.forEach((tweet) => {
						sentiments[tweet.sentiment]++;
						likes[tweet.sentiment] += tweet.likes;
						retweets[tweet.sentiment] += tweet.retweets;
						replies[tweet.sentiment] += tweet.replies;
					});

					const ctxSentiment = document
						.getElementById("sentimentChart")
						.getContext("2d");
					new Chart(ctxSentiment, {
						type: "pie",
						data: {
							labels: ["Positive", "Negative", "Neutral"],
							datasets: [
								{
									label: "Sentiment",
									data: [
										sentiments.positive,
										sentiments.negative,
										sentiments.neutral,
									],
									backgroundColor: [
										"rgba(75, 192, 192, 0.6)",
										"rgba(255, 99, 132, 0.6)",
										"rgba(255, 206, 86, 0.6)",
									],
									borderWidth: 1,
								},
							],
						},
						options: {
							responsive: true,
						},
					});

					const ctxAdditionalPie = document
						.getElementById("additionalPieChart")
						.getContext("2d");
					new Chart(ctxAdditionalPie, {
						type: "pie",
						data: {
							labels: ["Likes", "Retweets", "Replies"],
							datasets: [
								{
									label: "Engagement",
									data: [
										likes.positive + likes.negative + likes.neutral,
										retweets.positive + retweets.negative + retweets.neutral,
										replies.positive + replies.negative + replies.neutral,
									],
									backgroundColor: [
										"rgba(54, 162, 235, 0.6)",
										"rgba(153, 102, 255, 0.6)",
										"rgba(255, 159, 64, 0.6)",
									],
									borderWidth: 1,
								},
							],
						},
						options: {
							responsive: true,
						},
					});
				});

			fetch("/api/market-data")
				.then((response) => response.json())
				.then((marketData) => {
					const labels = marketData.map((data) => data.timestamp);
					const values = marketData.map((data) => parseFloat(data.value));
					const locations = marketData.map((data) => data.location);

					const locationCounts = locations.reduce((acc, location) => {
						acc[location] = (acc[location] || 0) + 1;
						return acc;
					}, {});

					const ctxLine = document.getElementById("lineChart").getContext("2d");
					new Chart(ctxLine, {
						type: "line",
						data: {
							labels: labels,
							datasets: [
								{
									label: "Market Value",
									data: values,
									backgroundColor: "rgba(75, 192, 192, 0.2)",
									borderColor: "rgba(75, 192, 192, 1)",
									borderWidth: 1,
									fill: true,
								},
							],
						},
						options: {
							responsive: true,
							scales: {
								x: {
									beginAtZero: true,
								},
								y: {
									beginAtZero: true,
								},
							},
						},
					});

					const ctxBar = document.getElementById("barChart").getContext("2d");
					new Chart(ctxBar, {
						type: "bar",
						data: {
							labels: Object.keys(locationCounts),
							datasets: [
								{
									label: "Number of Entries",
									data: Object.values(locationCounts),
									backgroundColor: "rgba(153, 102, 255, 0.6)",
									borderColor: "rgba(153, 102, 255, 1)",
									borderWidth: 1,
								},
							],
						},
						options: {
							responsive: true,
							scales: {
								x: {
									beginAtZero: true,
								},
								y: {
									beginAtZero: true,
								},
							},
						},
					});
				});
		</script>
	</body>
</html>
